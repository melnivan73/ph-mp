<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞–≥–∞–∑–∏–Ω –∫—Ä–∞—Å–∏–≤–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = null;
        let tgInitialized = false;
        let tgUserFromUrl = null;

        // –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä—è–º–æ –∏–∑ URL —Ö—ç—à–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è)
        function parseTgUserFromUrl() {
          try {
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            const tgWebAppData = params.get('tgWebAppData');
            if (tgWebAppData) {
              const decoded = decodeURIComponent(tgWebAppData);
              const dataParams = new URLSearchParams(decoded);
              const userStr = dataParams.get('user');
              if (userStr) {
                tgUserFromUrl = JSON.parse(decodeURIComponent(userStr));
                console.log('‚úÖ User from URL:', tgUserFromUrl);
              }
            }
          } catch(e) {
            console.warn('URL parse error:', e);
          }
        }
        parseTgUserFromUrl();

        function initTg() {
          if (window.Telegram && window.Telegram.WebApp) {
            tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand();
            tgInitialized = true;
            console.log('‚úÖ Telegram WebApp initialized');
          } else {
            console.warn('‚è≥ Waiting for Telegram WebApp...');
            setTimeout(initTg, 200);
          }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
        initTg();

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
        const API_URL = 'https://ph-mp-api.vercel.app';
        
        // –ö—É—Ä—Å TON –∫ UAH (–±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å API)
        const DEFAULT_TON_RATE = 64;

        // –§—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –ø–æ –∫–æ–¥—É –Ω–æ–º–µ—Ä–∞
        function getOperatorByCode(phoneNumber) {
            // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–¥ –∏–∑ —Å–∫–æ–±–æ–∫, –Ω–∞–ø—Ä–∏–º–µ—Ä –∏–∑ "+380 (67) 777-88-99" –±–µ—Ä–µ–º "67"
            const match = phoneNumber.match(/\((\d+)\)/);
            const code = match ? match[1] : '';
            
            // –ï—Å–ª–∏ –∫–æ–¥ 2-–∑–Ω–∞—á–Ω—ã–π, –¥–æ–±–∞–≤–ª—è–µ–º 0 –≤ –Ω–∞—á–∞–ª–æ –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
            const fullCode = code.length === 2 ? '0' + code : code;
            
            const operatorCodes = {
                '068': 'Kyivstar',
                '098': 'Kyivstar',
                '096': 'Kyivstar',
                '067': 'Kyivstar',
                '097': 'Kyivstar',
                '077': 'Kyivstar',
                '063': 'lifecell',
                '093': 'lifecell',
                '073': 'lifecell',
                '066': 'Vodafone',
                '050': 'Vodafone',
                '095': 'Vodafone',
                '075': 'Vodafone',
                '099': 'Vodafone'
            };
            
            return operatorCodes[fullCode] || '–ù–µ–≤—ñ–¥–æ–º–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä';
        }

        // –•—É–∫ debounce –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
        function useDebounce(value, delay) {
            const [debouncedValue, setDebouncedValue] = useState(value);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä–Ω—É–ª—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑ TON –∫–æ—à–µ–ª—å–∫–∞ –±–µ–∑ –æ–ø–ª–∞—Ç—ã
            useEffect(() => {
                const checkStartParam = () => {
                    try {
                        let startParam = null;
                        if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe) {
                            startParam = window.Telegram.WebApp.initDataUnsafe.start_param;
                        }
                        if (!startParam) {
                            const hash = window.location.hash;
                            const match = hash.match(/startapp=([^&]+)/);
                            if (match) startParam = decodeURIComponent(match[1]);
                        }
                        if (startParam && startParam.startsWith('cash_')) {
                            const orderId = startParam.replace('cash_', '');
                            setTonCashModal(orderId);
                        }
                    } catch(e) { console.error('startParam error:', e); }
                };
                // –ñ–¥—ë–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram
                setTimeout(checkStartParam, 500);
            }, []);

            useEffect(() => {
                const handler = setTimeout(() => {
                    setDebouncedValue(value);
                }, delay);

                return () => {
                    clearTimeout(handler);
                };
            }, [value, delay]);

            return debouncedValue;
        }

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function PhoneMarketplace() {
            const [phones, setPhones] = useState([]);
            const [filteredPhones, setFilteredPhones] = useState([]);
            const [searchQuery, setSearchQuery] = useState('');
            const [favorites, setFavorites] = useState(() => {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–±—Ä–∞–Ω–Ω–æ–µ –∏–∑ localStorage –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                const saved = localStorage.getItem('favorites');
                return saved ? JSON.parse(saved) : [];
            });
            const [selectedPhone, setSelectedPhone] = useState(null);
            const [activeTab, setActiveTab] = useState('catalog');
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [sortBy, setSortBy] = useState('cheap');
            const [maxPriceInput, setMaxPriceInput] = useState('');
            const [tonRate, setTonRate] = useState(DEFAULT_TON_RATE);
            const [selectedForOrder, setSelectedForOrder] = useState([]);
            const [orderError, setOrderError] = useState('');
            const [ordering, setOrdering] = useState(false);
            const [successModal, setSuccessModal] = useState(false);
            const [tonCashModal, setTonCashModal] = useState(null); // orderId –µ—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è –∏–∑ TON –±–µ–∑ –æ–ø–ª–∞—Ç—ã
            const [sameDigitsFilter, setSameDigitsFilter] = useState('all'); // 'all', '5', '6', '7'

            const handleShare = React.useCallback(() => {
                const parts = ['share'];
                if (sortBy !== 'cheap') parts.push('sort-' + sortBy);
                if (sameDigitsFilter !== 'all') parts.push('dig-' + sameDigitsFilter);
                if (maxPriceInput) parts.push('max-' + maxPriceInput);
                const param = parts.join('_');
                const appUrl = 'https://t.me/goldnumbersuashop_bot/gold_numbers?startapp=' + param;
                const text = encodeURIComponent('üì± –ü–æ–¥–∏–≤–∏—Å—å –Ω–∞ –∫—Ä–∞—Å–∏–≤—ñ –Ω–æ–º–µ—Ä–∏!');
                const shareUrl = 'https://t.me/share/url?url=' + encodeURIComponent(appUrl) + '&text=' + text;
                const webapp = window.Telegram && window.Telegram.WebApp;
                if (webapp) webapp.openTelegramLink(shareUrl);
                else window.open(shareUrl, '_blank');
            }, [sortBy, sameDigitsFilter, maxPriceInput]);
            
            // –ö–æ—Ä–æ—Ç–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ select
            const sortLabels = {
                cheap: '–î–µ—à–µ–≤—à–µ',
                expensive: '–î–æ—Ä–æ–∂—á–µ'
            };

            // Debounced –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
            const debouncedSearch = useDebounce(searchQuery, 300);
            const debouncedMaxPrice = useDebounce(maxPriceInput, 300);

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ API
            useEffect(() => {
                loadPhones();
                loadTonRate();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞ TON –∫–∞–∂–¥—ã–µ 60 –º–∏–Ω—É—Ç
                const interval = setInterval(loadTonRate, 60 * 60 * 1000);
                return () => clearInterval(interval);
            }, []);

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –≤ localStorage
            useEffect(() => {
                localStorage.setItem('favorites', JSON.stringify(favorites));
            }, [favorites]);

            async function loadPhones() {
                try {
                    setLoading(true);
                    setError(null);
                    
                    const response = await fetch(`${API_URL}/api/phones`);
                    
                    if (!response.ok) {
                        throw new Error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –¥–∞–Ω–∏—Ö');
                    }
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        setPhones(data.data);
                        setFilteredPhones(data.data);
                        // –í—Ä–µ–º–µ–Ω–Ω—ã–π –¥–µ–±–∞–≥ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–Ω—ã–π —Ö–µ—à
                        const debugDiv = document.createElement('div');
                        debugDiv.style.cssText = 'position:fixed;bottom:0;left:0;right:0;background:rgba(0,0,0,0.8);color:#fff;font-size:10px;padding:8px;z-index:99999;word-break:break-all;max-height:120px;overflow:auto;';
                        debugDiv.textContent = window.location.hash;
                        document.body.appendChild(debugDiv);
                        setTimeout(function() { if(debugDiv.parentNode) debugDiv.parentNode.removeChild(debugDiv); }, 15000);
                        
                        const tryApplyParam = function(attempt) {
                            try {
                                const tgApp = window.Telegram && window.Telegram.WebApp;
                                const param = tgApp && tgApp.initDataUnsafe && tgApp.initDataUnsafe.start_param;
                                if (!param && attempt < 10) {
                                    setTimeout(function() { tryApplyParam(attempt + 1); }, 200);
                                    return;
                                }
                                if (param && param.startsWith('share_')) {
                                    param.split('_').forEach(function(p) {
                                        if (p.indexOf('sort-') === 0) setSortBy(p.slice(5));
                                        else if (p.indexOf('dig-') === 0) setSameDigitsFilter(p.slice(4));
                                        else if (p.indexOf('max-') === 0) setMaxPriceInput(p.slice(4));
                                    });
                                }
                            } catch(ignore) {}
                        };
                        tryApplyParam(0);
                    } else {
                        throw new Error(data.error || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞');
                    }
                } catch (err) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:', err);
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            }

            async function loadTonRate() {
                try {
                    const response = await fetch(`${API_URL}/api/ton-rate`);
                    if (response.ok) {
                        const data = await response.json();
                        if (data.success && data.rate) {
                            console.log('–ö—É—Ä—Å TON –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ:', data.rate);
                            setTonRate(data.rate);
                        }
                    }
                } catch (err) {
                    console.log('–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∫—É—Ä—Å –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º:', DEFAULT_TON_RATE);
                }
            }

            // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 7 —Ü–∏—Ñ—Ä –Ω–æ–º–µ—Ä–∞
            const getLastSevenDigits = (number) => {
                const digits = number.replace(/\D/g, '');
                return digits.slice(-7);
            };

            // –ü–æ–¥—Å—á—ë—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ü–∏—Ñ—Ä –≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 7
            const countMaxSameDigits = (number) => {
                const lastSeven = getLastSevenDigits(number);
                const digitCounts = {};
                
                // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —á–∞—Å—Ç–æ—Ç—É –∫–∞–∂–¥–æ–π —Ü–∏—Ñ—Ä—ã
                for (let digit of lastSeven) {
                    digitCounts[digit] = (digitCounts[digit] || 0) + 1;
                }
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
                return Math.max(...Object.values(digitCounts));
            };

            // –ü–æ–∏—Å–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–∞—Å–∫–∏ * (–ª—é–±–∞—è —Ü–∏—Ñ—Ä–∞) - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
            const matchesWildcard = (pattern, text) => {
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã –∫—Ä–æ–º–µ *
                const cleanPattern = pattern.replace(/[^\d*]/g, '');
                
                // –ï—Å–ª–∏ –Ω–µ—Ç –∑–≤—ë–∑–¥–æ—á–µ–∫, –ø—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ –ø–æ –≤—Ö–æ–∂–¥–µ–Ω–∏—é
                if (!cleanPattern.includes('*')) {
                    return text.includes(cleanPattern);
                }
                
                // –°–æ–∑–¥–∞—ë–º —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
                // 555**** –æ–∑–Ω–∞—á–∞–µ—Ç: –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 555, –ø–æ—Ç–æ–º –ª—é–±—ã–µ 4 —Ü–∏—Ñ—Ä—ã
                let regexPattern = '^'; // –ù–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏
                
                for (let char of cleanPattern) {
                    if (char === '*') {
                        regexPattern += '\\d'; // * = —Ä–æ–≤–Ω–æ –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞
                    } else {
                        regexPattern += char; // –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ü–∏—Ñ—Ä–∞
                    }
                }
                
                // –ï—Å–ª–∏ –ø–∞—Ç—Ç–µ—Ä–Ω –∫–æ—Ä–æ—á–µ 7 —Å–∏–º–≤–æ–ª–æ–≤, –¥–æ–±–∞–≤–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ª—é–±—ã—Ö —Ü–∏—Ñ—Ä –≤ –∫–æ–Ω—Ü–µ
                const patternLength = cleanPattern.length;
                if (patternLength < 7) {
                    regexPattern += '\\d*'; // –õ—é–±—ã–µ —Ü–∏—Ñ—Ä—ã –≤ –∫–æ–Ω—Ü–µ
                }
                
                regexPattern += '$'; // –ö–æ–Ω–µ—Ü —Å—Ç—Ä–æ–∫–∏
                
                const regex = new RegExp(regexPattern);
                return regex.test(text);
            };

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            useEffect(() => {
                let filtered = phones;

                // –ü–æ–∏—Å–∫ –ø–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º 7 —Ü–∏—Ñ—Ä–∞–º —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–∞—Å–∫–∏
                if (debouncedSearch) {
                    filtered = filtered.filter(p => {
                        const lastSeven = getLastSevenDigits(p.number);
                        return matchesWildcard(debouncedSearch, lastSeven);
                    });
                }

                // –§–∏–ª—å—Ç—Ä –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Ü–∏—Ñ—Ä
                if (sameDigitsFilter !== 'all') {
                    const targetCount = parseInt(sameDigitsFilter);
                    filtered = filtered.filter(p => {
                        const maxCount = countMaxSameDigits(p.number);
                        return maxCount === targetCount;
                    });
                }

                // –§–∏–ª—å—Ç—Ä –ø–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ü–µ–Ω–µ
                if (debouncedMaxPrice) {
                    const maxPriceValue = parseInt(debouncedMaxPrice);
                    if (!isNaN(maxPriceValue)) {
                        filtered = filtered.filter(p => p.price <= maxPriceValue);
                    }
                }

                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
                if (sortBy === 'expensive') {
                    filtered = [...filtered].sort((a, b) => b.price - a.price);
                } else if (sortBy === 'cheap') {
                    filtered = [...filtered].sort((a, b) => a.price - b.price);
                }

                setFilteredPhones(filtered);
            }, [phones, debouncedSearch, sortBy, debouncedMaxPrice, sameDigitsFilter]);

            // –°—á—ë—Ç—á–∏–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤
            const searchCounter = useMemo(() => {
                return `–ó–Ω–∞–π–¥–µ–Ω–æ: ${filteredPhones.length} –∑ ${phones.length}`;
            }, [filteredPhones.length, phones.length]);

            // –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
            const toggleFavorite = (phoneId) => {
                setFavorites(prev => 
                    prev.includes(phoneId) 
                        ? prev.filter(id => id !== phoneId)
                        : [...prev, phoneId]
                );
            };

            // –ö–æ–Ω—Ç–∞–∫—Ç —Å –ø—Ä–æ–¥–∞–≤—Ü–æ–º
            const contactSeller = (phone) => {
                if (!tg) {
                    console.warn('tg not initialized yet');
                    return;
                }
                const message = `–í—ñ—Ç–∞—é! –¶—ñ–∫–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä ${phone.number} –∑–∞ ${phone.price.toLocaleString('uk-UA')} –≥—Ä–Ω.`;
                tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(message)}`);
            };

            // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ TON —Å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
            const convertToTon = (priceUah) => {
                const tonValue = priceUah / tonRate;
                return Math.round(tonValue);
            };

            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞
            const handleOrder = async (phonesToOrder) => {
                // –ö–æ—Ä–æ—Ç–∫–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –µ—Å–ª–∏ tg –µ—â–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è (–º–∞–∫—Å–∏–º—É–º 2 —Å–µ–∫)
                if (!tg) {
                    let attempts = 0;
                    while (!tgInitialized && attempts < 20) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                        attempts++;
                    }
                }
                // –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º ‚Äî –µ—Å—Ç—å fallback —á–µ—Ä–µ–∑ URL
                
                try {
                    setOrdering(true);
                    setOrderError('');

                    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (3 –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
                    let userId = null;
                    let username = null;

                    // 1. –ò–∑ window.Telegram.WebApp (–ü–ö)
                    if (tg && tg.initDataUnsafe?.user) {
                        userId = tg.initDataUnsafe.user.id;
                        username = tg.initDataUnsafe.user.username;
                    }

                    // 2. –ò–∑ initData —Å—Ç—Ä–æ–∫–∏
                    if (!userId && tg && tg.initData) {
                        try {
                            const params = new URLSearchParams(tg.initData);
                            const userStr = params.get('user');
                            if (userStr) {
                                const userData = JSON.parse(decodeURIComponent(userStr));
                                userId = userData.id;
                                username = userData.username;
                            }
                        } catch (e) {
                            console.error('Failed to parse initData:', e);
                        }
                    }

                    // 3. –ò–∑ URL —Ö—ç—à–∞ (–º–æ–±–∏–ª—å–Ω—ã–π Android/iOS)
                    if (!userId && tgUserFromUrl) {
                        userId = tgUserFromUrl.id;
                        username = tgUserFromUrl.username;
                    }
                    
                    const orderData = {
                        phones: phonesToOrder,
                        username: username || '–Ω–µ–≤—ñ–¥–æ–º–∏–π',
                        userId: userId
                    };
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª —Å—Ä–∞–∑—É ‚Äî –Ω–µ –∂–¥—ë–º –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–π UI)
                    setSuccessModal(true);
                    setSelectedForOrder([]);
                    if (selectedPhone) setSelectedPhone(null);

                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ —Ñ–æ–Ω–µ
                    fetch(`${API_URL}/api/order`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(orderData)
                    }).then(r => r.json()).then(data => {
                        if (!data.success) console.error('Order error:', data.error);
                    }).catch(e => console.error('Order fetch error:', e));

                } catch (error) {
                    console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:', error);
                    setOrderError(error.message || '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
                } finally {
                    setOrdering(false);
                }
            };

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –Ω–æ–º–µ—Ä–∞ –¥–ª—è –∑–∞–∫–∞–∑–∞
            const toggleSelectForOrder = (phoneId) => {
                setSelectedForOrder(prev =>
                    prev.includes(phoneId)
                        ? prev.filter(id => id !== phoneId)
                        : [...prev, phoneId]
                );
            };

            // –ó–∞–∫–∞–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ –∏–∑ –û–±—Ä–∞–Ω–µ
            const orderSelected = () => {
                console.log('üõí orderSelected called');
                console.log('üìã selectedForOrder:', selectedForOrder);
                
                if (selectedForOrder.length === 0) {
                    console.warn('‚ö†Ô∏è No phones selected');
                    setOrderError('–û–±–µ—Ä—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–∏–Ω –Ω–æ–º–µ—Ä');
                    setTimeout(() => setOrderError(''), 3000);
                    return;
                }

                const phonesToOrder = phones.filter(p => selectedForOrder.includes(p.id));
                console.log('üì± Phones to order:', phonesToOrder);
                handleOrder(phonesToOrder);
            };

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
            if (error && phones.length === 0) {
                return (
                    <div style={styles.container}>
                        <div style={styles.errorContainer}>
                            <div style={styles.errorIcon}>‚ö†Ô∏è</div>
                            <h2 style={styles.errorTitle}>–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</h2>
                            <p style={styles.errorText}>{error}</p>
                            <button style={styles.retryBtn} onClick={loadPhones}>
                                –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–æ–≤—É
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div style={styles.container}>
                    {/* –ú–æ–¥–∞–ª —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è */}
                    {tonCashModal && (
                        <div style={{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.6)',zIndex:9999,display:'flex',alignItems:'center',justifyContent:'center',padding:'20px'}}>
                            <div style={{background:'#fff',borderRadius:'16px',padding:'28px 24px',maxWidth:'320px',width:'100%',textAlign:'center',boxShadow:'0 8px 32px rgba(0,0,0,0.3)'}}>
                                <div style={{fontSize:'48px',marginBottom:'12px'}}>üí≥</div>
                                <h3 style={{margin:'0 0 8px',fontSize:'18px',fontWeight:'700',color:'#111'}}>–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤?</h3>
                                <p style={{margin:'0 0 20px',color:'#666',fontSize:'15px'}}>–í–∏ –º–æ–∂–µ—Ç–µ –æ—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑ –æ–ø–ª–∞—Ç–æ—é –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ.</p>
                                <button onClick={async () => {
                                    const oid = tonCashModal;
                                    setTonCashModal(null);
                                    try {
                                        const resp = await fetch(API_URL + '/api/pay-by-cash', {
                                            method: 'POST',
                                            headers: {'Content-Type':'application/json'},
                                            body: JSON.stringify({ orderId: oid })
                                        });
                                        const result = await resp.json();
                                        if (result.success) setSuccessModal(true);
                                    } catch(e) { console.error(e); }
                                }} style={{background:'#28a745',color:'#fff',border:'none',borderRadius:'10px',padding:'12px 32px',fontSize:'16px',fontWeight:'600',cursor:'pointer',width:'100%',marginBottom:'10px'}}>
                                    üíµ –û–ø–ª–∞—Ç–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ
                                </button>
                                <button onClick={() => setTonCashModal(null)} style={{background:'#eee',color:'#333',border:'none',borderRadius:'10px',padding:'10px 32px',fontSize:'15px',cursor:'pointer',width:'100%'}}>
                                    –°–∫–∞—Å—É–≤–∞—Ç–∏
                                </button>
                            </div>
                        </div>
                    )}
                    {successModal && (
                        <div style={{position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.5)',zIndex:9999,display:'flex',alignItems:'center',justifyContent:'center',padding:'20px'}}>
                            <div style={{background:'#fff',borderRadius:'16px',padding:'28px 24px',maxWidth:'320px',width:'100%',textAlign:'center',boxShadow:'0 8px 32px rgba(0,0,0,0.2)'}}>
                                <div style={{fontSize:'48px',marginBottom:'12px'}}>‚úÖ</div>
                                <h3 style={{margin:'0 0 8px',fontSize:'18px',fontWeight:'700',color:'#111'}}>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!</h3>
                                <p style={{margin:'0 0 20px',color:'#666',fontSize:'15px'}}>–û—á—ñ–∫—É–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –º–µ–Ω–µ–¥–∂–µ—Ä–∞.</p>
                                <button onClick={() => setSuccessModal(false)} style={{background:'#667eea',color:'#fff',border:'none',borderRadius:'10px',padding:'12px 32px',fontSize:'16px',fontWeight:'600',cursor:'pointer',width:'100%'}}>OK</button>
                            </div>
                        </div>
                    )}
                    {/* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∞–ø–∫–∞ */}
                    <div style={styles.stickyHeader}>
                        {/* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —à–∞–ø–∫–∞ */}
                        <div style={styles.header}>
                            <h1 style={styles.title}>üì± –ú–∞–≥–∞–∑–∏–Ω –∫—Ä–∞—Å–∏–≤–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤</h1>
                            <p style={styles.subtitle}>–ü—ñ–¥–±–µ—Ä—ñ—Ç—å —Å–æ–±—ñ –Ω–∞–π–∫—Ä–∞—â–∏–π –Ω–æ–º–µ—Ä</p>
                        </div>

                        {/* –¢–∞–±—ã */}
                        <div style={{display:'flex', alignItems:'center', gap:'8px', padding:'0 20px', marginBottom:'12px'}}>
                            <button 
                                style={{...styles.tab, ...(activeTab === 'catalog' ? styles.activeTab : {})}}
                                onClick={() => setActiveTab('catalog')}
                            >
                                –ö–∞—Ç–∞–ª–æ–≥
                            </button>
                            <button 
                                style={{...styles.tab, ...(activeTab === 'favorites' ? styles.activeTab : {})}}
                                onClick={() => setActiveTab('favorites')}
                            >
                                –û–±—Ä–∞–Ω–µ ({favorites.length})
                            </button>
                            <button onClick={handleShare} style={{background:'none',border:'1px solid #667eea',color:'#667eea',borderRadius:'8px',padding:'6px 10px',fontSize:'12px',cursor:'pointer',whiteSpace:'nowrap',flexShrink:0}}>üîó</button>
                        </div>

                        {activeTab === 'catalog' && (
                            <>
                                {/* –ü–æ–∏—Å–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–∞—Å–∫–∏ */}
                                <div style={styles.searchContainer}>
                                    <input
                                        type="text"
                                        placeholder="üîç –ü–æ—à—É–∫ –∑–∞ —Ü–∏—Ñ—Ä–∞–º–∏"
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        maxLength={7}
                                        style={styles.searchInput}
                                    />
                                    <div style={styles.searchInfoRow}>
                                        <div style={styles.searchHint}><span style={{fontSize: '18px', verticalAlign: 'middle', lineHeight: '13px'}}>*</span> - –±—É–¥—å-—è–∫–∞ —Ü–∏—Ñ—Ä–∞</div>
                                        <div style={styles.searchCounter}>{searchCounter}</div>
                                    </div>
                                </div>

                                {/* –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ */}
                                <div style={styles.filtersRow}>
                                    <div style={{position: 'relative', flex: '0 0 35%'}}>
                                        <select 
                                            style={styles.sortSelect}
                                            value={sortBy}
                                            onChange={(e) => setSortBy(e.target.value)}
                                        >
                                            <option value="cheap">–°–ø–æ—á–∞—Ç–∫—É –¥–µ—à–µ–≤—à–µ</option>
                                            <option value="expensive">–°–ø–æ—á–∞—Ç–∫—É –¥–æ—Ä–æ–∂—á–µ</option>
                                        </select>
                                        <div style={styles.sortDisplayText}>{sortLabels[sortBy]}</div>
                                        <div style={styles.sortArrow}>
                                            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M4 9l8 8 8-8" stroke="#667eea" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" fill="none"/>
                                            </svg>
                                        </div>
                                    </div>

                                    <div style={styles.priceFilterInput}>
                                        <input
                                            type="number"
                                            placeholder="–û–±–º–µ–∂–∏—Ç–∏ —Ü—ñ–Ω—É"
                                            value={maxPriceInput}
                                            onChange={(e) => {
                                                const value = e.target.value;
                                                if (value.length <= 6) {
                                                    setMaxPriceInput(value);
                                                }
                                            }}
                                            maxLength={6}
                                            style={styles.priceInput}
                                        />
                                        <span style={styles.priceLabel}>–≥—Ä–Ω.</span>
                                    </div>
                                </div>

                                {/* –§–∏–ª—å—Ç—Ä –ø–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º —Ü–∏—Ñ—Ä–∞–º */}
                                <div style={styles.sameDigitsFilter}>
                                    <div style={styles.sameDigitsLabel}>–æ–¥–Ω–∞–∫–æ–≤–∏—Ö –≤ –Ω–æ–º–µ—Ä—ñ</div>
                                    <div style={styles.sameDigitsButtons}>
                                        <button
                                            style={{
                                                ...styles.sameDigitsBtn,
                                                ...(sameDigitsFilter === 'all' ? styles.sameDigitsBtnActive : {})
                                            }}
                                            onClick={() => setSameDigitsFilter('all')}
                                        >
                                            –≤—Å—ñ
                                        </button>
                                        <button
                                            style={{
                                                ...styles.sameDigitsBtn,
                                                ...(sameDigitsFilter === '5' ? styles.sameDigitsBtnActive : {})
                                            }}
                                            onClick={() => setSameDigitsFilter('5')}
                                        >
                                            5
                                        </button>
                                        <button
                                            style={{
                                                ...styles.sameDigitsBtn,
                                                ...(sameDigitsFilter === '6' ? styles.sameDigitsBtnActive : {})
                                            }}
                                            onClick={() => setSameDigitsFilter('6')}
                                        >
                                            6
                                        </button>
                                        <button
                                            style={{
                                                ...styles.sameDigitsBtn,
                                                ...(sameDigitsFilter === '7' ? styles.sameDigitsBtnActive : {})
                                            }}
                                            onClick={() => setSameDigitsFilter('7')}
                                        >
                                            7
                                        </button>
                                    </div>
                                </div>
                            </>
                        )}
                    </div>

                    {/* –ü—Ä–æ—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –±–µ–∑ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ */}
                    {activeTab === 'catalog' ? (
                        loading ? (
                            <div style={styles.loading}>
                                <div style={styles.spinner}></div>
                                <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ–º–µ—Ä—ñ–≤...</p>
                            </div>
                        ) : (
                            <div style={styles.phoneList}>
                                {filteredPhones.map(phone => (
                                    <PhoneCard
                                        key={phone.id}
                                        phone={phone}
                                        isFavorite={favorites.includes(phone.id)}
                                        onToggleFavorite={() => toggleFavorite(phone.id)}
                                        onSelect={() => setSelectedPhone(phone)}
                                        convertToTon={convertToTon}
                                    />
                                ))}
                                {filteredPhones.length === 0 && (
                                    <div style={styles.noResults}>
                                        <p>–ù–æ–º–µ—Ä–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>
                                        <p style={styles.noResultsHint}>–°–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏</p>
                                    </div>
                                )}
                            </div>
                        )
                    ) : (
                        <div style={styles.phoneList}>
                            {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π */}
                            {phones.filter(p => favorites.includes(p.id)).length > 0 && (
                                <div style={styles.orderInstruction}>
                                    –ü–æ–∑–Ω–∞—á—Ç–µ –Ω–æ–º–µ—Ä–∏ –¥–ª—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
                                </div>
                            )}

                            {/* –û—à–∏–±–∫–∞ */}
                            {orderError && (
                                <div style={styles.orderError}>
                                    {orderError}
                                </div>
                            )}

                            {/* –°–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Å —á–µ–∫–±–æ–∫—Å–∞–º–∏ */}
                            {phones.filter(p => favorites.includes(p.id)).map(phone => (
                                <div key={phone.id} style={styles.phoneCardWithCheckbox}>
                                    <input
                                        type="checkbox"
                                        checked={selectedForOrder.includes(phone.id)}
                                        onChange={() => toggleSelectForOrder(phone.id)}
                                        style={styles.checkbox}
                                    />
                                    <div style={{...styles.phoneCard, flex: 1, margin: 0}} onClick={() => setSelectedPhone(phone)}>
                                        <div style={styles.cardContent}>
                                            <div style={styles.phoneNumber}>{phone.number}</div>
                                            <button
                                                style={styles.favoriteBtn}
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    toggleFavorite(phone.id);
                                                }}
                                            >
                                                ‚ù§Ô∏è
                                            </button>
                                        </div>
                                        <div style={styles.priceContainer}>
                                            <div style={styles.priceUah}>{phone.price.toLocaleString('uk-UA')} –≥—Ä–Ω.</div>
                                            <div style={styles.priceTon}>üíé {convertToTon(phone.price)} TON</div>
                                        </div>
                                    </div>
                                </div>
                            ))}

                            {/* –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */}
                            {phones.filter(p => favorites.includes(p.id)).length === 0 && (
                                <div style={styles.noResults}>
                                    <p>–û–±—Ä–∞–Ω–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤ –Ω–µ–º–∞—î</p>
                                    <p style={styles.noResultsHint}>–î–æ–¥–∞–π—Ç–µ –Ω–æ–º–µ—Ä–∏, —è–∫—ñ —Å–ø–æ–¥–æ–±–∞–ª–∏—Å—å</p>
                                </div>
                            )}

                            {/* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫–∞–∑–∞ */}
                            {phones.filter(p => favorites.includes(p.id)).length > 0 && (
                                <div style={styles.orderButtonContainer}>
                                    <button 
                                        style={styles.orderButton}
                                        onClick={orderSelected}
                                        disabled={ordering}
                                    >
                                        {ordering ? '–í—ñ–¥–ø—Ä–∞–≤–∫–∞...' : 'üí¨ –ó–∞–º–æ–≤–∏—Ç–∏'}
                                    </button>
                                </div>
                            )}
                        </div>
                    )}

                    {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π */}
                    {selectedPhone && (
                        <PhoneDetails
                            phone={selectedPhone}
                            onClose={() => setSelectedPhone(null)}
                            onContact={handleOrder}
                            isFavorite={favorites.includes(selectedPhone.id)}
                            onToggleFavorite={() => toggleFavorite(selectedPhone.id)}
                            convertToTon={convertToTon}
                        />
                    )}
                </div>
            );
        }

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–æ–º–µ—Ä–∞
        function PhoneCard({ phone, isFavorite, onToggleFavorite, onSelect, convertToTon }) {
            return (
                <div style={styles.phoneCard} onClick={onSelect}>
                    <div style={styles.cardContent}>
                        <div style={styles.phoneNumber}>{phone.number}</div>
                        <button
                            style={styles.favoriteBtn}
                            onClick={(e) => {
                                e.stopPropagation();
                                onToggleFavorite();
                            }}
                        >
                            {isFavorite ? '‚ù§Ô∏è' : 'ü§ç'}
                        </button>
                    </div>
                    <div style={styles.priceContainer}>
                        <div style={styles.priceUah}>{phone.price.toLocaleString('uk-UA')} –≥—Ä–Ω.</div>
                        <div style={styles.priceTon}>üíé {convertToTon(phone.price)} TON</div>
                    </div>
                </div>
            );
        }

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function PhoneDetails({ phone, onClose, onContact, isFavorite, onToggleFavorite, convertToTon }) {
            return (
                <div style={styles.modal} onClick={onClose}>
                    <div style={styles.modalContent} onClick={(e) => e.stopPropagation()}>
                        <div style={styles.modalHeader}>
                            <h2 style={styles.modalTitle}>–î–µ—Ç–∞–ª—ñ –Ω–æ–º–µ—Ä–∞</h2>
                            <button style={styles.closeBtn} onClick={onClose}>‚úï</button>
                        </div>

                        <div style={styles.modalBody}>
                            <div style={styles.detailsNumber}>{phone.number}</div>
                            <div style={styles.detailsOperator}>–û–ø–µ—Ä–∞—Ç–æ—Ä: {getOperatorByCode(phone.number)}</div>

                            <div style={styles.detailsPriceBox}>
                                <div style={styles.detailsPriceRow}>
                                    <span style={styles.priceLabel}>–¶—ñ–Ω–∞ –≤ –≥—Ä–∏–≤–Ω—è—Ö:</span>
                                    <span style={styles.priceValueUah}>{phone.price.toLocaleString('uk-UA')} –≥—Ä–Ω.</span>
                                </div>
                                <div style={styles.detailsPriceRow}>
                                    <span style={styles.priceLabel}>–¶—ñ–Ω–∞ –≤ TON:</span>
                                    <span style={styles.priceValueTon}>üíé {convertToTon(phone.price)} TON</span>
                                </div>
                            </div>
                        </div>

                        <div style={styles.modalFooter}>
                            <button 
                                style={styles.favoriteModalBtn}
                                onClick={onToggleFavorite}
                            >
                                {isFavorite ? '‚ù§Ô∏è –í –æ–±—Ä–∞–Ω–æ–º—É' : 'ü§ç –î–æ –æ–±—Ä–∞–Ω–æ–≥–æ'}
                            </button>
                            <button 
                                style={styles.contactModalBtn} 
                                onClick={() => {
                                    onContact([phone]);
                                    onClose();
                                }}
                            >
                                üí¨ –ó–∞–º–æ–≤–∏—Ç–∏
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // –°—Ç–∏–ª–∏
        const styles = {
            container: {
                fontFamily: '"Manrope", -apple-system, BlinkMacSystemFont, sans-serif',
                backgroundColor: '#17212b',
                color: '#ffffff',
                minHeight: '100vh',
                paddingBottom: '20px'
            },
            stickyHeader: {
                position: 'sticky',
                top: 0,
                backgroundColor: '#17212b',
                zIndex: 100,
                paddingBottom: '12px',
                boxShadow: '0 2px 8px rgba(0,0,0,0.3)'
            },
            header: {
                background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                color: 'white',
                padding: '16px 20px',
                textAlign: 'center',
                borderRadius: '0 0 16px 16px',
                marginBottom: '12px'
            },
            title: {
                margin: '0 0 4px 0',
                fontSize: '20px',
                fontWeight: '800',
                letterSpacing: '-0.5px'
            },
            subtitle: {
                margin: 0,
                fontSize: '13px',
                opacity: 0.95,
                fontWeight: '500'
            },
            tabs: {
                display: 'flex',
                gap: '8px',
                padding: '0 20px',
                marginBottom: '12px'
            },
            tab: {
                flex: 1,
                padding: '10px',
                border: 'none',
                borderRadius: '10px',
                backgroundColor: '#fff',
                color: '#666',
                fontSize: '14px',
                fontWeight: '600',
                cursor: 'pointer',
                transition: 'all 0.2s',
                boxShadow: '0 2px 4px rgba(0,0,0,0.06)'
            },
            activeTab: {
                backgroundColor: '#667eea',
                color: 'white',
                boxShadow: '0 4px 12px rgba(102, 126, 234, 0.4)'
            },
            searchContainer: {
                padding: '0 20px',
                marginBottom: '8px'
            },
            searchInput: {
                width: '100%',
                padding: '12px 14px',
                border: '2px solid #e5e7eb',
                borderRadius: '10px',
                fontSize: '18px',
                outline: 'none',
                boxSizing: 'border-box',
                transition: 'border-color 0.2s',
                fontWeight: '600'
            },
            searchInfoRow: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginTop: '4px'
            },
            searchHint: {
                fontSize: '13px',
                color: '#ffffff',
                fontWeight: '500',
                textShadow: '0 1px 2px rgba(0,0,0,0.2)'
            },
            searchCounter: {
                fontSize: '12px',
                color: '#ffffff',
                fontWeight: '600',
                textShadow: '0 1px 2px rgba(0,0,0,0.2)'
            },
            filtersRow: {
                display: 'flex',
                gap: '8px',
                padding: '0 20px',
                marginBottom: '8px'
            },
            sortSelect: {
                width: '100%',
                padding: '12px 38px 12px 10px',
                border: '2px solid #e5e7eb',
                borderRadius: '10px',
                fontSize: '13px',
                fontWeight: '600',
                backgroundColor: 'white',
                cursor: 'pointer',
                outline: 'none',
                appearance: 'none',
                WebkitAppearance: 'none',
                MozAppearance: 'none',
                color: 'transparent',
                height: '48px',
                boxSizing: 'border-box',
                backgroundImage: 'none'
            },
            sortDisplayText: {
                position: 'absolute',
                top: '50%',
                left: '10px',
                right: '40px',
                transform: 'translateY(-50%)',
                fontSize: '14px',
                fontWeight: '600',
                color: '#1a1a1a',
                pointerEvents: 'none'
            },
            sortArrow: {
                position: 'absolute',
                top: '50%',
                right: '10px',
                transform: 'translateY(-50%)',
                pointerEvents: 'none',
                display: 'flex',
                alignItems: 'center'
            },
            priceFilterInput: {
                flex: '1 1 65%',
                display: 'flex',
                alignItems: 'center',
                gap: '8px',
                backgroundColor: 'white',
                padding: '0 12px',
                border: '2px solid #e5e7eb',
                borderRadius: '10px',
                minWidth: 0,
                height: '48px',
                boxSizing: 'border-box'
            },
            priceInput: {
                flex: 1,
                border: 'none',
                outline: 'none',
                fontSize: '16px',
                fontWeight: '700',
                padding: '12px 0',
                minWidth: 0
            },
            priceLabel: {
                fontSize: '15px',
                fontWeight: '700',
                color: '#6b7280',
                whiteSpace: 'nowrap',
                flexShrink: 0
            },
            sameDigitsFilter: {
                padding: '0 20px',
                marginBottom: '12px'
            },
            sameDigitsLabel: {
                fontSize: '13px',
                fontWeight: '600',
                color: '#ffffff',
                marginBottom: '8px',
                textShadow: '0 1px 2px rgba(0,0,0,0.2)'
            },
            sameDigitsButtons: {
                display: 'flex',
                gap: '8px'
            },
            sameDigitsBtn: {
                flex: 1,
                padding: '10px',
                border: '2px solid #e5e7eb',
                borderRadius: '10px',
                backgroundColor: 'white',
                color: '#1a1a1a',
                fontSize: '14px',
                fontWeight: '700',
                cursor: 'pointer',
                transition: 'all 0.2s',
                boxShadow: '0 2px 4px rgba(0,0,0,0.06)'
            },
            sameDigitsBtnActive: {
                backgroundColor: '#667eea',
                color: 'white',
                borderColor: '#667eea',
                boxShadow: '0 4px 12px rgba(102, 126, 234, 0.4)'
            },
            phoneList: {
                padding: '0 20px 20px 20px',
                marginTop: '12px'
            },
            phoneCard: {
                backgroundColor: 'white',
                borderRadius: '12px',
                padding: '16px',
                marginBottom: '10px',
                boxShadow: '0 4px 12px rgba(0,0,0,0.3)',
                cursor: 'pointer',
                transition: 'transform 0.2s, box-shadow 0.2s'
            },
            cardContent: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '10px'
            },
            phoneNumber: {
                fontSize: '20px',
                fontWeight: '800',
                color: '#1a1a1a',
                letterSpacing: '-0.3px'
            },
            favoriteBtn: {
                background: 'none',
                border: 'none',
                fontSize: '24px',
                cursor: 'pointer',
                padding: '4px'
            },
            priceContainer: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                paddingTop: '10px',
                borderTop: '1px solid #f3f4f6'
            },
            priceUah: {
                fontSize: '18px',
                fontWeight: '800',
                color: '#667eea'
            },
            priceTon: {
                fontSize: '14px',
                fontWeight: '700',
                color: '#0088cc',
                backgroundColor: '#e0f2fe',
                padding: '4px 10px',
                borderRadius: '6px'
            },
            loading: {
                textAlign: 'center',
                padding: '40px',
                fontSize: '15px',
                color: '#999'
            },
            spinner: {
                width: '40px',
                height: '40px',
                margin: '0 auto 16px',
                border: '4px solid #f0f0f0',
                borderTop: '4px solid #667eea',
                borderRadius: '50%',
                animation: 'spin 1s linear infinite'
            },
            errorContainer: {
                textAlign: 'center',
                padding: '60px 20px',
                maxWidth: '400px',
                margin: '0 auto'
            },
            errorIcon: {
                fontSize: '64px',
                marginBottom: '20px'
            },
            errorTitle: {
                fontSize: '24px',
                fontWeight: 'bold',
                marginBottom: '12px',
                color: '#1a1a1a'
            },
            errorText: {
                fontSize: '16px',
                color: '#666',
                marginBottom: '24px',
                lineHeight: '1.5'
            },
            retryBtn: {
                padding: '14px 32px',
                backgroundColor: '#667eea',
                color: 'white',
                border: 'none',
                borderRadius: '12px',
                fontSize: '16px',
                fontWeight: '600',
                cursor: 'pointer'
            },
            noResults: {
                textAlign: 'center',
                padding: '40px 20px',
                color: '#999'
            },
            noResultsHint: {
                fontSize: '14px',
                marginTop: '8px'
            },
            modal: {
                position: 'fixed',
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                backgroundColor: 'rgba(0,0,0,0.5)',
                display: 'flex',
                alignItems: 'flex-end',
                zIndex: 1000
            },
            modalContent: {
                backgroundColor: 'white',
                borderRadius: '20px 20px 0 0',
                width: '100%',
                overflow: 'hidden'
            },
            modalHeader: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                padding: '20px',
                borderBottom: '1px solid #f0f0f0'
            },
            modalTitle: {
                margin: 0,
                fontSize: '20px',
                fontWeight: 'bold'
            },
            closeBtn: {
                background: 'none',
                border: 'none',
                fontSize: '24px',
                cursor: 'pointer',
                padding: '4px',
                color: '#999'
            },
            modalBody: {
                padding: '10px 20px'
            },
            detailsNumber: {
                fontSize: '26px',
                fontWeight: 'bold',
                color: '#1a1a1a',
                marginBottom: '8px'
            },
            detailsOperator: {
                fontSize: '15px',
                color: '#666',
                marginBottom: '20px'
            },
            detailsSection: {
                marginBottom: '20px'
            },
            sectionTitle: {
                fontSize: '16px',
                fontWeight: '600',
                marginBottom: '8px',
                color: '#1a1a1a'
            },
            sectionText: {
                fontSize: '14px',
                color: '#666',
                lineHeight: '1.5'
            },
            features: {
                display: 'flex',
                flexWrap: 'wrap',
                gap: '6px'
            },
            featureTag: {
                padding: '4px 10px',
                backgroundColor: '#f0f0f0',
                borderRadius: '6px',
                fontSize: '12px',
                color: '#555'
            },
            detailsPriceBox: {
                padding: '16px',
                backgroundColor: '#f8f9fa',
                borderRadius: '12px',
                marginTop: '12px'
            },
            detailsPriceRow: {
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center',
                marginBottom: '8px'
            },
            priceLabel: {
                fontSize: '14px',
                color: '#666',
                fontWeight: '600'
            },
            priceValueUah: {
                fontSize: '22px',
                fontWeight: 'bold',
                color: '#667eea'
            },
            priceValueTon: {
                fontSize: '18px',
                fontWeight: 'bold',
                color: '#0088cc'
            },
            modalFooter: {
                padding: '20px',
                display: 'flex',
                gap: '10px',
                borderTop: '1px solid #f0f0f0'
            },
            favoriteModalBtn: {
                flex: 1,
                padding: '14px',
                border: '2px solid #667eea',
                borderRadius: '12px',
                backgroundColor: 'white',
                color: '#667eea',
                fontSize: '15px',
                fontWeight: '600',
                cursor: 'pointer'
            },
            contactModalBtn: {
                flex: 1,
                padding: '14px',
                border: 'none',
                borderRadius: '12px',
                backgroundColor: '#667eea',
                color: 'white',
                fontSize: '15px',
                fontWeight: '600',
                cursor: 'pointer'
            },
            orderInstruction: {
                backgroundColor: '#e0f2fe',
                padding: '12px 16px',
                borderRadius: '10px',
                marginBottom: '16px',
                fontSize: '14px',
                fontWeight: '600',
                color: '#0369a1',
                textAlign: 'center'
            },
            orderError: {
                backgroundColor: '#fee2e2',
                padding: '12px 16px',
                borderRadius: '10px',
                marginBottom: '16px',
                fontSize: '14px',
                fontWeight: '600',
                color: '#991b1b',
                textAlign: 'center'
            },
            phoneCardWithCheckbox: {
                display: 'flex',
                alignItems: 'center',
                gap: '12px',
                marginBottom: '10px'
            },
            checkbox: {
                width: '20px',
                height: '20px',
                cursor: 'pointer',
                accentColor: '#667eea',
                flexShrink: 0
            },
            orderButtonContainer: {
                position: 'fixed',
                bottom: 0,
                left: 0,
                right: 0,
                padding: '16px 20px',
                backgroundColor: 'white',
                boxShadow: '0 -4px 12px rgba(0,0,0,0.1)',
                zIndex: 50
            },
            orderButton: {
                width: '100%',
                padding: '16px',
                border: 'none',
                borderRadius: '12px',
                backgroundColor: '#667eea',
                color: 'white',
                fontSize: '16px',
                fontWeight: '700',
                cursor: 'pointer',
                transition: 'all 0.2s'
            }
        };

        // CSS –∞–Ω–∏–º–∞—Ü–∏—è
        const styleSheet = document.createElement("style");
        styleSheet.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            input[type="number"]::-webkit-inner-spin-button,
            input[type="number"]::-webkit-outer-spin-button {
                -webkit-appearance: none;
                margin: 0;
            }
            
            input[type="number"] {
                -moz-appearance: textfield;
            }
            
            /* –°—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –≥–∞–ª–æ—á–∫–∏ –≤ select */
            select option:checked {
                font-weight: 700;
            }
            
            select {
                appearance: none !important;
                -webkit-appearance: none !important;
                -moz-appearance: none !important;
            }
            
            select::-ms-expand {
                display: none;
            }
        `;
        document.head.appendChild(styleSheet);

        // –†–µ–Ω–¥–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        ReactDOM.render(<PhoneMarketplace />, document.getElementById('root'));
    </script>
</body>
</html>
