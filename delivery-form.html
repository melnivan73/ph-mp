<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∞–Ω—ñ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Manrope', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #17212b;
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 24px;
            font-weight: 800;
            margin: 0 0 8px 0;
            color: #ffffff;
        }

        .subtitle {
            font-size: 14px;
            color: #a0aec0;
            margin: 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #ffffff;
        }

        .input {
            width: 100%;
            padding: 14px 16px;
            font-size: 16px;
            border: 2px solid #2d3748;
            border-radius: 12px;
            background-color: #1a252f;
            color: #ffffff;
            outline: none;
            transition: border-color 0.2s;
            font-family: 'Manrope', sans-serif;
        }

        .input:focus {
            border-color: #667eea;
        }

        .input::placeholder {
            color: #4a5568;
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            font-weight: 700;
            color: white;
            background-color: #667eea;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
        }

        .submit-btn:hover:not(:disabled) {
            background-color: #5568d3;
            transform: translateY(-1px);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .error-message {
            display: none;
            padding: 12px 16px;
            background-color: #fee2e2;
            color: #991b1b;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .error-message.show {
            display: block;
        }

        .success-box {
            text-align: center;
            padding: 60px 20px;
        }

        .success-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .success-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #ffffff;
        }

        .success-text {
            font-size: 16px;
            color: #a0aec0;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .close-btn {
            padding: 14px 32px;
            background-color: #667eea;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .error-box {
            text-align: center;
            padding: 60px 20px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // API URL
        const API_URL = 'https://ph-mp-api.vercel.app';

        // –ü–æ–ª—É—á–∞–µ–º orderId –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('orderId');

        const root = document.getElementById('root');

        if (!orderId) {
            root.innerHTML = '<div class="container"><div class="error-box"><h2>‚ùå –ü–æ–º–∏–ª–∫–∞</h2><p>ID –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p></div></div>';
        } else {
            renderForm();
        }

        function renderForm() {
            root.innerHTML = '<div class="container"><div class="header"><h1 class="title">üì¶ –î–∞–Ω—ñ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏</h1><p class="subtitle">–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ù–æ–≤–æ—é –ü–æ—à—Ç–æ—é</p></div><form id="deliveryForm"><div class="form-group"><label class="label">–¢–µ–ª–µ—Ñ–æ–Ω *</label><input type="tel" name="phone" placeholder="+380 XX XXX XX XX" required class="input" /></div><div class="form-group"><label class="label">–ü—Ä—ñ–∑–≤–∏—â–µ *</label><input type="text" name="lastName" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—Ä—ñ–∑–≤–∏—â–µ" required class="input" /></div><div class="form-group"><label class="label">–Ü–º\'—è *</label><input type="text" name="firstName" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º\'—è" required class="input" /></div><div class="form-group"><label class="label">–ú—ñ—Å—Ç–æ *</label><input type="text" name="city" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ö–∏—ó–≤" required class="input" /></div><div class="form-group"><label class="label">–û–±–ª–∞—Å—Ç—å *</label><input type="text" name="region" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ö–∏—ó–≤—Å—å–∫–∞" required class="input" /></div><div class="form-group"><label class="label">–†–∞–π–æ–Ω</label><input type="text" name="district" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ä–∞–π–æ–Ω (–Ω–µ–æ–±–æ–≤\'—è–∑–∫–æ–≤–æ)" class="input" /></div><div class="form-group"><label class="label">–°–∫–ª–∞–¥ –ù–æ–≤–æ—ó –ü–æ—à—Ç–∏ ‚Ññ *</label><input type="text" name="warehouse" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 5" required class="input" /></div><div id="errorMessage" class="error-message"></div><button type="submit" id="submitBtn" class="submit-btn">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –¥–∞–Ω—ñ</button></form></div>';

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
            document.getElementById('deliveryForm').addEventListener('submit', handleSubmit);
        }

        async function handleSubmit(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const errorMessage = document.getElementById('errorMessage');
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
            const formData = new FormData(e.target);
            const data = {
                orderId: orderId,
                phone: formData.get('phone'),
                lastName: formData.get('lastName'),
                firstName: formData.get('firstName'),
                city: formData.get('city'),
                region: formData.get('region'),
                district: formData.get('district'),
                warehouse: formData.get('warehouse')
            };

            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É
            submitBtn.disabled = true;
            submitBtn.textContent = '–í—ñ–¥–ø—Ä–∞–≤–∫–∞...';
            errorMessage.classList.remove('show');
            errorMessage.textContent = '';

            try {
                const response = await fetch(API_URL + '/api/delivery-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    // –£—Å–ø–µ—Ö - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    root.innerHTML = '<div class="container"><div class="success-box"><div class="success-icon">‚úÖ</div><h2 class="success-title">–î–∞–Ω—ñ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!</h2><p class="success-text">–¢–µ–ø–µ—Ä –æ–±–µ—Ä—ñ—Ç—å —Å–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏ –≤ —á–∞—Ç—ñ –∑ –±–æ—Ç–æ–º</p><button class="close-btn" onclick="window.Telegram.WebApp.close()">–ó–∞–∫—Ä–∏—Ç–∏</button></div></div>';
                } else {
                    throw new Error(result.error || '–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏');
                }

            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                errorMessage.textContent = error.message || '–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–∏—Ö. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.';
                errorMessage.classList.add('show');
                
                submitBtn.disabled = false;
                submitBtn.textContent = '–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –¥–∞–Ω—ñ';
            }
        }
    </script>
</body>
</html>
